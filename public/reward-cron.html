<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title></title>
      <style>
         body {
         font-family: "Open Sans", sans-serif;
         font-size: 13px;
         font-weight: 400;
         color: #8184a1;
         line-height: 1.3;
         }
         h4 {
         margin-top: 0;
         margin-bottom: 50px;
         }
         /* a:link, a:visited {
         transition: color 0.15s ease 0s, border-color 0.15s ease 0s, background-color 0.15s ease 0s;
         } */
         .container {
         display: flex;
         width: 100%;
         height: 100vh;
         flex-direction: column;
         justify-content: center;
         align-items: center;
         }
         .quantity {
         display: flex;
         align-items: center;
         justify-content: center;
         padding: 0;
         }
         .quantity__minus,
         .quantity__plus {
         display: block;
         width: 22px;
         height: 23px;
         margin: 0;
         background: #dee0ee;
         text-decoration: none;
         text-align: center;
         line-height: 23px;
         }
         .quantity__minus:hover,
         .quantity__plus:hover {
         background: #575b71;
         color: #fff;
         } 
         .quantity__minus {
         border-radius: 3px 0 0 3px;
         }
         .quantity__plus {
         border-radius: 0 3px 3px 0;
         }
         .quantity__input {
         width: 32px;
         height: 19px;
         margin: 0;
         padding: 0;
         text-align: center;
         border-top: 2px solid #dee0ee;
         border-bottom: 2px solid #dee0ee;
         border-left: 1px solid #dee0ee;
         border-right: 2px solid #dee0ee;
         background: #fff;
         color: #8184a1;
         }
         .quantity__minus:link,
         .quantity__plus:link {
         color: #8184a1;
         } 
         .quantity__minus:visited,
         .quantity__plus:visited {
         color: #fff;
         }
      </style>
   </head>
   <body>
      <div class="container">
         <textarea class="_usernames" placeholder="Ignore usernames..." rows="5" style="width:500px"></textarea><br/><br/>
         <h1 class="_message" style="color: green;">Run Income Cron</h1>
         <h3 class="nextRun" style="color: orange;">on CSS and JS</h4>
         <div class="quantity quantityLoade">
            <!-- <a href="#" class="quantity__minus"><span>-</span></a> -->
            <input name="quantity" type="text" class="quantity__input" value="">
            <a href="#" class="quantity__plus"><span>+</span></a>
         </div>
      </div>


      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>


      <script>
      	getDate = (days) =>{
      		return moment().add(days-1, 'days').format('DD-MM-YYYY')
      	}
         $(document).ready(function() {
         	const minus = $('.quantity__minus');
         	const plus = $('.quantity__plus');
         	const input = $('.quantity__input');
      
         	

		var storageUsernames = localStorage.getItem("usernames");
		if(storageUsernames) $('._usernames').val(storageUsernames);


		var currentCrone = localStorage.getItem("currentCrone");
		if(currentCrone) input.val(currentCrone);
		

		$(document).on('input','._usernames', function () {
         		localStorage.setItem("usernames", $('._usernames').val());
			
		});

		$(document).on('input','.quantity__input', function () {
			value = input.val();
         		localStorage.setItem("currentCrone", value);
			$('.nextRun').html(`Next Run For -  ${value} : ${getDate(value)}`); 
		});

         $('.nextRun').html(`next run for ${input.val()} : ${getDate(input.val())}`); 
         	plus.click(function(e) {
         		$('.quantityLoade').hide();
         		
         		let usernames = $('._usernames').val();
         		e.preventDefault();
         		var value = input.val();
         		console.log(value);
         		var url = 'https://app.ifortunecoin.io/dev/run-cron/'+value;
         		$.ajax({
         			url: url,
         			type: 'POST',
         			// dataType: 'jsonp', 
         			data:{
         				date: getDate(value),
         				usernames: usernames,
         			},
         			success : function() { 
         				$('._message').html(`Cron Run At ${value} : ${getDate(value)}`); 
         				value++;
         				input.val(value);
         				localStorage.setItem("currentCrone", value);
         				$('.nextRun').html(`Next Run For -  ${value} : ${getDate(value)}`); 
         				$('.quantityLoade').show();
         			},
         			error : function(jqXHR, textStatus, errorThrown) {
         				alert('Error: '+jqXHR.status);
         				$('.quantityLoade').show();
		           } 
		         });

         		console.log(url);
         	})
         });
      </script>
   </body>
</html>